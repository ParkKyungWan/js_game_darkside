<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">



    <title>Darkness</title>
    <link rel="icon" href="title.png"/>
    <style>
        * { padding: 0; margin: 0; }
        canvas {

            background: #eee; display: block; margin: 0 auto;

            animation-duration: 2s;
            animation-name: slideup;
        }
        #background{
            animation-duration: 4s;
            animation-name: toblack;
        }

        @keyframes slideup {
            /*등장애니*/
            from {
                margin-top: 100%;
            }

            to {
                margin: 0 auto;
            }
        }
        @keyframes toblack{
            /*배경애니*/
            from{opacity: 0; filter: alpha(opacity=0)

            }
            to{opacity: 1; filter: alpha(opacity=100)
            }
        }

    </style>
    <link href="https://fonts.googleapis.com/css?family=Bungee+Hairline|Righteous" rel="stylesheet">
    <style tyle="text/css">
        h1 {
            /*타이틀의 글꼴 설정*/
            font-family: 'Bungee Hairline', cursive;
            font-family: 'Righteous', cursive;
            padding: 5px;
            color: white;
        }

        p{
            /*본문의 글꼴 설정*/
            font-family: 'Bungee Hairline', cursive;
            font-family: 'Righteous', cursive;
            color: white;
        }
    </style>
</head>


//헤더 끝 본문 시작

<body style="background-color:black;">
<div align="center">
    <div class="container" id="background" style="width: 1280px; height:720px;
        background-color: black;">

        <EMBED id="sound1" SRC="" autostart="false" volume="3000" hidden="true"id="sound1">
        <EMBED id="sound2" SRC="" autostart="false" volume="0" hidden="true" >
       

        <div align="center">
            <div class="jumbotron text-center">
                //타이틀의 글꼴 설정
                <h1 style="visibility: collapse;" id="title">Tutorial</h1>
            </div>
        </div>
        <div class="container" style="background-color: rgba(0,0,0,0); width:605px;height:550px;">
            <div class="container"  id="edgediv" style="background-color:black; width:605px; height:470px; ">
                <canvas style="padding:1px;"id="myCanvas" width="600" height="465"></canvas>
                     <script>//30
                        //캔버스
                        var canvas = document.getElementById("myCanvas");
                        var ctx = canvas.getContext("2d");

                        var img = new Image();//이미지


                        var degree = new Image();
                        degree.src = "degree3.png"; //게이지
                        var degree_num = {
                            fear :0,
                            faster: 2,//공포게이지수치
                            heal:0.03
                        }

                        var speaking = true; //자동 혼잣말

                        /*var check_x = new Array();
                        var check_y = new Array(); // 체크포인트 좌표
                        var cancheck = true;
                        var canremove = true;*/

                        var dx = 0;
                        var dy = 0; // 방향값

                        var lockx; //막혔을때
                        var locky;
                        var lock_player = false;

                        var wall;


                        var text; //플레이어 대사
                        var random_number;  //말풍선 코드

                        var num = 0;
                        var shaking_num_x = 0;
                        var shaking_num_y = 0;

                        var location_shake = false;

                        var block = {
                            location_x : 0,
                            location_y : 0,
                            scale : 0
                        }//떨어진 블록
                        var wave={
                            wavex : 0,
                            wavey : 0,
                            wavescale : 0

                        }//떨어진 블록에 의한 파동


                        var tuto_count = 0;

                        var scale_e;
                        var x_e;
                        var y_e;
                        
                        //----------------------------------------------------------음향---------------------------------------



                        var audio_crash = new Audio('Object_Toss_and_Smash_Glass.mp3');
                        audio_crash.volume = 1;
                        var audio_bgm1 = new Audio('Decay.mp3');
                        /*Kevin MacLeod의 Decay은(는) Creative Commons Attribution 라이선스(https://creativecommons.org/licenses/by/4.0/)에 따라 라이선스가 부여됩니다.
                        출처: http://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100512
                        아티스트: http://incompetech.com/*/
                        audio_bgm1.volume = 1; 
                        var audio_crowd = new Audio('Crowd_Talking.mp3');
                        audio_crowd.volume = 0.7;
                        var audio_crowd2 = new Audio('Crowd_Yelling_Series.mp3');
                        audio_crowd2.volume = 1;
                        var audio_bgm3 = new Audio('End_of_Time.mp3');
                        audio_bgm3.volume = 0.7;
                        audio_bgm3.loop = true;

                        //----------------------------------------------------------음향---------------------------------------
                        var fblock={
                            x: new Array(),
                            y: new Array(),
                            scale: new Array()
                        } //떨어져서 못가는 구역이 된 곳
                        
                        var end_point={
                            x: Math.floor(Math.random() * (canvas.width-10))+10,
                            y: Math.floor(Math.random() * 440)+10
                        }
                    
                        var key_direction = {
                            w: 1,
                            a: -1,
                            s: -1,
                            d: 1
                        }    




                        var player = {
                            x : 30,
                            y : 30,
                            length : 9,
                            color : "white",
                            safe : true,
                            speed :1,
                            talking: true,

                            stage: getCookie('stage')
                            //firstsafe: false
                        };
                        var right = false;
                        var left = false;
                        var up = false;
                        var down = false;
                        /*----------------삭제 ---------------------------------------------------------
                        var check = false; // 체크
                        var remove = false; //최근체크 삭제
                        ----------------삭제 ---------------------------------------------------------*/
                        
                        var shaked_ = 1; //블럭이 뒤집혔는지


                        




                        document.addEventListener("keydown", push, false); //누르는지 확인
                        document.addEventListener("keyup", pull, false);  //놓았는지 확인

                        function push(key) { //누를때
                            if(lock_player != true){
                            if(key.keyCode == 68) {
                                right = true;
                            }else if(key.keyCode == 65) {
                                left = true;
                            }else if(key.keyCode == 87){
                                up = true;
                            }else if(key.keyCode == 83){
                                down = true;
                            }
                            /*----------------삭제 ---------------------------------------------------------
                            else if(key.keyCode == 74){
                                check = true;
                            }else if(key.keyCode == 75){
                                remove = true;
                            }----------------삭제 ---------------------------------------------------------*/
                        }
                        }
                        function pull(key) { //놓을때
                        
                            if(key.keyCode == 68) {
                                right = false;
                            }else if(key.keyCode == 65) {
                                left = false;
                            }else if(key.keyCode == 87){
                                up = false;
                            }else if(key.keyCode == 83){
                                down = false;
                            }
                            /*----------------삭제 ---------------------------------------------------------
                            else if(key.keyCode == 74){
                                check = false;
                            }else if(key.keyCode == 75){
                                remove = false;
                            }----------------삭제 ---------------------------------------------------------*/
                        }

                        function setCookie(cName, cValue, cDay){ //쿠키 만들기
                            var expire = new Date();
                            expire.setDate(expire.getDate() + cDay);
                            cookies = cName + '=' + escape(cValue) + '; path=/ '; // 한글 깨짐을 막기위해 escape(cValue)를 합니다.
                            if(typeof cDay != 'undefined') cookies += ';expires=' + expire.toGMTString() + ';';
                            document.cookie = cookies;
                        }function getCookie(cName) { //쿠키 가져오기
                            cName = cName + '=';
                            var cookieData = document.cookie;
                            var start = cookieData.indexOf(cName);
                            var cValue = '';
                            if(start != -1){
                                start += cName.length;
                                var end = cookieData.indexOf(';', start);
                                if(end == -1)end = cookieData.length;
                                cValue = cookieData.substring(start, end);
                            }
                            return unescape(cValue);
                        }   //쿠키구문 출처: http://superkts.pe.kr/helper/view.php?seq=V&seq=263

                        function rectangle(x,y,width,height,color) { //사각형 생성
                            y = canvas.height-y;


                            ctx.beginPath();
                            ctx.rect(x+shaking_num_x, y+shaking_num_y, width, height);
                            ctx.fillStyle = color;
                            ctx.fill();
                            ctx.closePath();
                        }
                        function clearmap(color) { //맵청소
                            ctx.clearRect(0,0,canvas.width, canvas.height );
                            ctx.beginPath();
                            ctx.rect(0, 0, canvas.width, canvas.height);
                            ctx.fillStyle = color;
                            ctx.fill();
                            ctx.closePath();
                        }

                        function circle(x,y,length,color) { // 원생성
                            y = canvas.height-y;
                            ctx.beginPath();
                            ctx.arc(x+shaking_num_x, y+shaking_num_y, length, 0, Math.PI*2, false);
                            ctx.fillStyle = color;
                            ctx.fill();
                            ctx.closePath();
                        }

                        function cool(type){ //쿨타임 제작기

                            if(type == "mark"){
                                setTimeout(function () {
                                    cancheck = true;
                                }, 500); //마크 생성 쿨타임


                            }else if(type =="remove"){
                                setTimeout(function () {
                                    canremove = true;
                                }, 300); //마크 삭제 쿨타임

                            }
                        }



                        /*----------------삭제 ---------------------------------------------------------
                        function marking(){

                            if(check){ //마킹
                                if(cancheck) { //쿨타임 돌았는지 확인
                                    check_x.push(player.x);
                                    check_y.push(player.y);
                                    cancheck = false;
                                    cool("mark");
                                }else{
                                    player.color = "gray";    //마킹때 플레이어 깜빡이기
                                    setTimeout(function () {
                                        player.color = "white"
                                    },100)
                                }
                            }

                            for(i=0;i<check_x.length;i++){ //마크 그려주기
                                 rectangle(check_x[i],check_y[i],10,10,"gray");
                            }


                            if(remove){ // 최근 마킹삭제
                                if(canremove){
                                    rectangle(check_x.pop(),check_y.pop(),12,12,"black");
                                    canremove = false;
                                    cool("remove");
                                }
                            }

                        }-------------------------------------------------------------------------------
                        */  //마크를 하는 기능
                         

                        /* ------------------어디에 떨어졌는지 확인할 수 있습니다-------------------------*/
                        /*setInterval(function(){
                        for(i=0;i<fblock.x.length;i++){
                            rectangle(fblock.x[i],fblock.y[i],fblock.scale[i],fblock.scale[i],'blue');
                        }
                        },1)*/
                        function test_safe(_x,_y) { //안전불안전 반환
                                /*if(player.x > canvas.width - player.length||player.x < player.length||player.y > 450 - player.length||player.y > player.length){
                                    return false; //맵탈출시
                                }*/
                            
                                if(shaked_ == 1){
                                    
                                    
                                    if(key_direction.w==1){
                                        for(i=0;i<fblock.x.length;i++){
                                            if(_x+player.length >= fblock.x[i]-player.length&&_x-player.length<= (fblock.x[i]+fblock.scale[i]+player.length)&&_y-player.length<=fblock.y[i]+player.length&&_y+player.length>=(fblock.y[i]-fblock.scale[i]-player.length)){
                                                return false;
                                            }
                                        }
                                        
                                    }
                                        
                                }
                                if(key_direction.w==-1){
                                        for(i=0;i<fblock.x.length;i++){
                                            if(_x-player.length <= fblock.x[i]+player.length&&_x+player.length>= (fblock.x[i]-fblock.scale[i]-player.length)&&_y+player.length>=fblock.y[i]-player.length&&_y-player.length<=(fblock.y[i]+fblock.scale[i]+player.length)){
                                                return false;
                                            }
                                        }
                                    }
                                
                                
                                if (player.stage == 0) { //스테이지 0일때
                                    /*if(_y < 200+player.length&&_x>100-player.length&&_y>120-player.length&&_x<player.length+180){
                                        return false;
                                    }*/
                                }

                        }
                        
                        function wave(x,y,color,power,num){ //음파생성
                            setInterval(function() {
                                circle(x,y,power,color);
                            },num);
                        }




                        function degree_of_fear(num,color){//상단 게이지
                            degree_num.fear = num;     
                            if(degree_num.fear*6 >= canvas.width){
                                degree_num.fear = canvas.width/6;

                            }
                            if(degree_num.fear*6 <= 0){
                                degree_num.fear = 0;
                            }
                            ctx.beginPath();
                            ctx.rect(degree_num.fear*6,0, canvas.width-(degree_num.fear*6), canvas.height-450);
                            ctx.fillStyle = "white";
                            ctx.fill();
                            ctx.closePath();
                            //rectangle(degree_num.fear*6,canvas.height,canvas.width-(degree_num.fear*6),canvas.height-450,color);
                        }


                        function text_box(text,color,time1,time2){ // 말풍선제작
                            random_number =Math.floor(Math.random() * 1000);
                            private_code = random_number;

                            print(private_code);

                            function print(code){

                              ctx.font = "14px 맑은 고딕";
                              ctx.fillStyle = color;

                              var make_text = setInterval(function() {
                                if(code == random_number){
                                  ctx.fillText(text, player.x +player.length*2, canvas.height-player.length -player.y);
                                }
                              },time1);

                              setTimeout(function() {
                                if(code == random_number){
                                clearTimeout(make_text);
                              }},time2);



                            }
                      }

                        function make_text_box(){ //자동대사
                            var random = Math.floor(Math.random() * 10);
                            if (speaking == true){
                            switch(random){
                                case 0:
                                    text = "아무것도 안보여..";
                                    break;
                                case 1:
                                    text = "멈춰라.. 멈춰라..";
                                    break;
                                case 2:
                                    text = "일단 기댈 곳을 찾아야겠어";
                                    break;
                                case 3:
                                    text = "방향을 모르겠어..";
                                    break;
                                case 4:
                                    text = "누구 있어요?";
                                    break;
                                case 5:
                                    text = "나갈 방법이 있을거야";
                                    break;
                                case 6:
                                    text = "직감을 믿어보자.. ";
                                    break;
                                case 7:
                                    text = "언제 멈추는거야";
                                    break;
                                case 8:
                                    text = "하아..";
                                    break;
                                case 9:
                                    text = "제발제발제발";
                                    break;
                                case 10:
                                    text = "저기요! 살려주세요!";
                                    break;
                            }

                            text_box("\n" + "\n" +text, "white",5,700);
                            }

                        }
                        
                    function dynamic_player(){ //플레이어 이동&그리기
                            
                        clearmap("black"); //맵 청소
                        if( lock_player != true) { //잠금 확인

                            var pm; //+ - 결정( 버그픽수중. 안먹힘)
                            //circle(player.x, player.y, player.length + 1, "black"); //플레이어 삭제
                            var lock_x = 0;
                            var lock_y = 0;

                            var distance_x;
                            var distance_y;
                            var distance;



                            var degree_f = degree_num.fear; //바의 수치
                            var degree_c = "white"; //바의 색깔

                            wall = false; // 벽 인식아직 x
                            
                            if(player.stage==0){
                                tuto_count +=1;
                                if(tuto_count == 2000){
                                    location_shake = true;
                                }
                                if(tuto_count == 3500){
                                    audio_crash.play();
                                        block.location_x = 300;
                                        block.location_y = 70;
                                        block.scale = 100;
                                        
                                        fblock.x.push(block.location_x);
                                        fblock.y.push(block.location_y);
                                        fblock.scale.push(block.scale);


                                        wave.wavex = block.location_x-40;
                                        wave.wavey = block.location_y+40;
                                        wave.wavescale = block.scale+80;
                                            
                                        
                                        
                                        function waves(count){
                                            if(count<canvas.width*canvas.height*3){
                                                setTimeout(function(){
                                                    
                                                    wave.wavex -=40;
                                                    wave.wavey +=40;
                                                    wave.wavescale +=80;
                                                    count = wave.wavescale*wave.wavescale
                                                    
                                                    waves(count);
                                                },50)
                                            }
                                        }
                                        waves(block.scale*block.scale); //0.5초마다 파동 생성
                                }
                                if(tuto_count == 7501){
                                    audio_crowd2.play();

                                    speaking = false;


                                    gangdo_x = Math.floor(Math.random() * 600)+300;
                                    for(i = 0;i<=gangdo_x;i++){
                                        direction = Math.floor(Math.random() * 2)+1;
                                        if(direction == 1){setTimeout(function(){shaking_num_x+=1;
                                        if(test_safe(player.x+0.5,player.y) != false){
                                            player.x += 0.5;
                                        }},i*5);
                                        }else{setTimeout(function(){shaking_num_x-=1;
                                        if(test_safe(player.x-0.5,player.y) != false){
                                            player.x -= 0.5;
                                        }},i*5);}
                                        
                                    }
                                    setTimeout(function(){shaking_num_x = 0;},gangdo_x*5)//x좌표 방향으로 흔들림
                                    
                                    gangdo_y = Math.floor(Math.random() * 600)+300;
                                    for(i2 = 0;i2<=gangdo_y;i2++){
                                        direction2 = Math.floor(Math.random() * 2)+1;
                                        if(direction2 == 1){
                                        setTimeout(function(){shaking_num_y+=1;
                                        //rectangle(Math.floor(Math.random()*canvas.width)+1,Math.floor(Math.random()*canvas.height)+1,Math.floor(Math.random()*30)+4,Math.floor(Math.random()*30)+4,'gray');
                                        if(test_safe(player.x,player.y+0.5) != false){
                                            player.y += 0.5;
                                        }},i2*5);
                                        }else{setTimeout(function(){shaking_num_y-=1;
                                        if(test_safe(player.x,player.y-0.5)  != false){
                                            player.y -= 0.5;
                                        }},i2*5);}
                                    }

                                    
                                    text_box("으아아","white",5,gangdo_y*5);
                                }

                                if(tuto_count <= 1500){
                                    img.src = "tuto_1.png"; 
                                }else if(tuto_count<=3000){
                                    img.src = "tuto_2.png"; 
                                }else if(tuto_count<=4500){
                                    img.src = "tuto_3.png"; 
                                }else if(tuto_count<=6000){
                                    img.src = "tuto_4.png"; 
                                }else if(tuto_count<=7500){
                                    img.src = "tuto_5.png"; 
                                }else if(tuto_count<=8000){
                                    img.src = "tuto_6.png";
                                }else if(tuto_count==8700){
                                    setCookie('stage',1,1);
                                    location.reload();
                                }
                                
                                ctx.drawImage(img, 0, canvas.height-450);
                                

                            }else{
                                distance_x = (player.x-end_point.x)*(player.x-end_point.x);
                                distance_y = (player.y-end_point.y)*(player.y-end_point.y);
                                distance =  Math.sqrt(distance_x+distance_y);
                                
                                distance_x = Math.sqrt((end_point.x*end_point.x)+(end_point.y*end_point.y));
                                distance_y = Math.sqrt(((player.x-end_point.x)*(player.x-end_point.x))+((player.y-end_point.y)*(player.y-end_point.y)));
                                if(distance_x< distance_y){
                                    audio_crowd.volume = 0;
                                    audio_crowd2.volume = 0;
                                }else{
                                    audio_crowd.volume = (distance_x-distance_y)/distance_x;
                                    audio_crowd2.volume = (distance_x-distance_y)/distance_x;
                                }

                            }



                            if(location_shake == true){
                                player.x = 600-player.x;
                                player.y = 450-player.y;
                                location_shake = false;
                                key_direction.w = -key_direction.w;
                                key_direction.a = -key_direction.a;
                                key_direction.s = -key_direction.s;
                                key_direction.d = -key_direction.d;
                                
                                if(key_direction.w ==-1){
                                document.getElementById('title').style = 'transform: rotate(180deg);'

                                }else{
                                document.getElementById('title').style = 'transform: rotate(0deg);'
                                    
                                }

                                end_point.x = canvas.width-end_point.x;
                                end_point.y = 450-end_point.y;


                            }

                            //클리어
                            if(player.stage == 1){
                                if((distance_x-distance_y)/distance_x>0.8){
                                player.stage =2;
                                x_e = player.x;
                                y_e = player.y;
                                scale_e = 50;
                                

                                }
                            }
                            if(player.stage == 2){ // 엔딩모션
                                rectangle(x_e,y_e,scale_e,scale_e,'white');
                                x_e -= 2;
                                audio_crowd.pause();
                                audio_bgm3.pause();
                                audio_crash.pause();
                                audio_crowd2.pause();
                                y_e += 2;
                                player.color = 'black';
                                scale_e += 4;
                                speaking = false;
                                ctx.font = "14px 맑은 고딕";
                                ctx.fillStyle = 'black';
                                ctx.fillText("살아남았어...", player.x +player.length*2, canvas.height-player.length -player.y);
                                
                            }


                                if (test_safe(player.x+player.speed,player.y) == false){
                                    lock_x = 1;
                                }
                                if(test_safe(player.x-player.speed,player.y)== false){
                                    lock_x = -1;
                                }
                                if(test_safe(player.x,player.y+player.speed)== false){
                                    lock_y = 1;
                                }
                                if(test_safe(player.x,player.y-player.speed)== false){
                                    lock_y = -1;
                                }


                                dx = dy = 0;

                                if(key_direction.w >0){
                                if (right && player.x <= canvas.width - player.length &&lock_x !=1) { //오른쪽 이동
                                    player.x += player.speed;
                                    dx = 1;

                                }else if (left && player.x >= player.length&&lock_x !=-1) { //왼쪽 이동
                                    player.x -= player.speed;
                                    dx = -1;
                                }
                                if (up && player.y <= 450 - player.length&&lock_y !=1) { //위로 이동
                                    player.y += player.speed;
                                    dy = 1;
                                }else if (down && player.y >= player.length&&lock_y !=-1) { //아래로 이동
                                    player.y -= player.speed;
                                    dy = -1;
                                }
                                    
                                }else{


                                if (left && player.x <= canvas.width - player.length &&lock_x !=1) { //오른쪽 이동
                                    player.x += player.speed;
                                    dx = 1;

                                }else if (right && player.x >= player.length&&lock_x !=-1) { //왼쪽 이동
                                    player.x -= player.speed;
                                    dx = -1;
                                }
                                if (down && player.y <= 450 - player.length&&lock_y !=1) { //위로 이동
                                    player.y += player.speed;
                                    dy = 1;
                                }else if (up && player.y >= player.length&&lock_y !=-1) { //아래로 이동
                                    player.y -= player.speed;
                                    dy = -1;
                                }

                                }
                                
                                


                            // 색주변일때 배경전환 (삭제, 이유:소리강화)
                            /*

                                if(player.stage == 0){ //스테이지0일때 , 스팟 200,450
                                    if(player.x > 200 && player.x<400 && player.y >300){
                                        var xm = player.x - 200;
                                        var ym = 450-player.y;
                                        var final = (250-xm-ym)/250;
                                        rectangle(0-shaking_num_x,canvas.height-shaking_num_y,canvas.width,canvas.height,"rgba(255,0,0,"+final+")");
                                        //지진면역
                                    
                                    }

                                }*/

                                if (lock_x != 0) {  //부딪힌 벽 표시
                                    rectangle(lock_x * (player.length + 5) + player.x, canvas.height, 3, 4500, "rgba(255,255,255,0.7)");
                                }
                                if (lock_y != 0) {
                                        rectangle(0, lock_y * (player.length + 5) + player.y, canvas.width+100, 3, "rgba(255,255,255,0.7)");
                                }

                                if(lock_x !=0 || lock_y !=0){  // 벽을 잡고 걸을때
                                    wall = true;
                                    player.color = "rgba(255,255,255,0.7)";
                                    player.speed = 0.05; //0.1
                                    degree_f = degree_num.fear-degree_num.heal;
                                    if(speaking ==true){
                                    text_box("...","gray",0.001,0.05);
                                    }
                                }else{
                                    degree_c = "rgba(255,255,255,0.8)"; //바의 색깔 변경
                                    player.speed = 0.05; //0.035
                                    player.color = "red";
                                    num += 1;
                                    if(num > 20){  //20/ 20번반복시 빨강
                                        player.color = "white";
                                        if(num > 400){  //400//20번~200번반복시 하양
                                            num = 0;
                                            make_text_box();
                                            degree_f = degree_num.fear+degree_num.faster; //degree_num.fear 은 최대 100% 까지 .  게이지의 크기와 비례
                                        }
                                    }
                                }





                                
                            
                            degree_of_fear(degree_f,degree_c);//게이지
                            }
//--------------------------------(튕기는 모션인데 버그있음) 튕겨서 안전하지않은곳이면 버그걸림-----------------------------------------------------------------------------------------------------------
                                /*if(block ) {

                                        if(player.firstsafe == true && player.safe!=true){
                                            pm = -1;
                                        }else{
                                            pm = 1;
                                        }


                                        if (dx > 0) {    //x방향 밀치기
                                            player.x -= 4*pm
                                        } else if (dx < 0) {
                                            player.x += 4*pm
                                        }

                                        if (dy > 0) { //y방향 밀치기
                                            player.y -= 4*pm
                                        } else if (dy < 0) {
                                            player.y += 4*pm
                                        }

                                        if (player.x < player.length) {
                                            player.x = player.length;
                                        } else if (player.x > canvas.width - player.length) {
                                            player.x = canvas.width - player.length;
                                        }

                                        if (player.y > canvas.height - player.length) {
                                            player.y = canvas.height - player.length;
                                        } else if (player.y < player.length) {
                                            player.y = player.length;
                                        }          //맵탈출제어

                                        if (player.safe == true) {
                                            player.firstsafe = true;
                                        }



                                }


*/                            
                            if(player.stage == 2){
                                
                                player.color = 'black';
                            }
                            circle(player.x-shaking_num_x, player.y+shaking_num_y, player.length, player.color);//플레이어 생성
                        }





                        

                        /* 본문 */
                        
                        window.onload = function() {
                        if(getCookie('stage') == ''){  //레벨 최초생성
                            setCookie('stage',0,7);
                        }
                        img.src = "level" + player.stage + ".png";
                        clearmap("black");
                        img.onload = function () { //인트로
                            ctx.drawImage(img, 0, canvas.height-450);
                            }


                        setTimeout(function() {
                            lock = false; //잠금해제
                            document.getElementById("title").style.visibility = "visible"; //타이틀 생성
                            document.getElementById("q").style.visibility = "visible"; //도움말 생성
                            document.getElementById("title").innerText = " Dark side of loneliness ";


                            rectangle(0,canvas.height,canvas.width,canvas.height,"black");//캔버스바탕 검정칠
                            setInterval(dynamic_player,3); //플레이어 계속 그리기
                            //-------------------------------------------------------------------------------
                            //삭제//setInterval(marking,30); //계속 마킹
                            //-------------------------------------------------------------------------------
                            setInterval(function(){

                            //rectangle(100,200,80,80,"white");
                            },5) //개발중 벽보이게 하기

                            
                            setInterval(function(){if(wave.wavescale*wave.wavescale<canvas.height*canvas.width*3){
                                rectangle(wave.wavex,wave.wavey,wave.wavescale,wave.wavescale,'gray');
                                rectangle(wave.wavex+4,wave.wavey-4,wave.wavescale-8,wave.wavescale-8,'black');
                                rectangle(block.location_x,block.location_y,block.scale,block.scale,'gray');

                            }},5)//떨어지는거 그리기*/
                            
                            

                            setInterval(function(){ // 소규모
                                gangdo__x = 500;
                                if(wall != true){
                                for(i = 0;i<=gangdo__x;i++){
                                    direction = Math.floor(Math.random() * 2)+1;
                                    if(direction == 1){setTimeout(function(){
                                    if(test_safe(player.x+0.5,player.y) != false){
                                        //player.x += 0.17;
                                    }},i*5);
                                    }else{setTimeout(function(){
                                    if(test_safe(player.x-0.5,player.y) != false){
                                        //player.x -= 0.17;
                                    }},i*5);}
                                    
                                }
                                setTimeout(function(){shaking_num_x = 0;},gangdo__x*5)//x좌표 방향으로 흔들림
                                
                                gangdo__y = 500;
                                for(i2 = 0;i2<=gangdo__y;i2++){
                                    direction2 = Math.floor(Math.random() * 2)+1;
                                    if(direction2 == 1){
                                      setTimeout(function(){
                                    if(test_safe(player.x,player.y+0.5) != false){
                                        //player.y += 0.17;
                                    }},i2*5);
                                    }else{setTimeout(function(){
                                    if(test_safe(player.x,player.y-0.5)  != false){
                                        //player.y -= 0.17;
                                    }},i2*5);}
                                }
                                setTimeout(function(){shaking_num_y = 0;},gangdo__y*5)//x좌표 방향으로 흔들림
                                }

                            },7000);

                          /*  setInterval(
                       function show_safe(){
                            for(i=0;i<fblock.x.length;i++){
                                    rectangle(fblock.x[i]-player.length,fblock.y[i]+player.length,fblock.scale[i],fblock.scale[i],'white');
                                }
                        },1);  *///개발중 벽보이기




                            setInterval(function(){
                                if(degree_num.fear >= 100){
                                    if(player.stage == 0){
                                        setCookie('stage',1,1);
                                    }
                                  location.reload();
                                }
                            },1000); // 게이지 다떨어지면 게임오버
                            




                            if(player.stage == 1){
                                audio_bgm3.volume = 0.3;
                                audio_bgm3.load()
                                audio_bgm3.play();
                                audio_crowd.loop = true;
                                audio_crowd.volume = 0;
                                audio_crowd.load();
                                audio_crowd.play();
                                audio_crowd2.volume = 0;

                                setInterval(function(){ //지진 일으키기
                                if(player.stage == 1){
                                speaking = false;


                                gangdo_x = Math.floor(Math.random() * 600)+300;
                                for(i = 0;i<=gangdo_x;i++){
                                    direction = Math.floor(Math.random() * 2)+1;
                                    if(direction == 1){setTimeout(function(){shaking_num_x+=1;
                                    if(test_safe(player.x+0.5,player.y) != false){
                                        player.x += 0.5;
                                    }},i*5);
                                    }else{setTimeout(function(){shaking_num_x-=1;
                                    if(test_safe(player.x-0.5,player.y) != false){
                                        player.x -= 0.5;
                                    }},i*5);}
                                    
                                }
                                setTimeout(function(){shaking_num_x = 0;},gangdo_x*5)//x좌표 방향으로 흔들림
                                
                                gangdo_y = Math.floor(Math.random() * 600)+300;
                                for(i2 = 0;i2<=gangdo_y;i2++){
                                    direction2 = Math.floor(Math.random() * 2)+1;
                                    if(direction2 == 1){
                                      setTimeout(function(){shaking_num_y+=1;
                                      //rectangle(Math.floor(Math.random()*canvas.width)+1,Math.floor(Math.random()*canvas.height)+1,Math.floor(Math.random()*30)+4,Math.floor(Math.random()*30)+4,'gray');
                                    if(test_safe(player.x,player.y+0.5) != false){
                                        player.y += 0.5;
                                    }},i2*5);
                                    }else{setTimeout(function(){shaking_num_y-=1;
                                    if(test_safe(player.x,player.y-0.5)  != false){
                                        player.y -= 0.5;
                                    }},i2*5);}
                                }

                                 
                                text_box("으아아","white",5,gangdo_y*5);
                                audio_crowd2.load();
                                audio_crowd2.play();
                                /*//스턴먹이기 (삭제)
                                setTimeout(function(){ speaking = true;shaking_num_y = 0; lock_player = true; player.color = "gray"; text_box("으..으으","gray",5,3000);
                                */
                                setTimeout(function(){lock_player = false; player.color="white";

                                change_q = Math.floor(Math.random() * 10)+1;
                                if(change_q>0){
                                for(i=0;i<fblock.x.length;i++){ // 블럭 방향 뒤바꾸기
                                                fblock.x[i] = 600-fblock.x[i]//-(fblock.scale[i]/2);
                                                fblock.y[i] = 450-fblock.y[i]//+(fblock.scale[i]/2);
                                                
                                            }
                                shaked_ = -shaked_; //바뀜
                                location_shake =true; //플레이어 뒤바꾸기 
                                audio_crowd2.pause();

                                } // 위치 바꾸기 30%;



                                // 스턴 있을땐 푸세요},3000)
                                },gangdo_y*5);//x좌표 방향으로 흔들림
                                
                                setTimeout(//천장떨어지는거
                                    function(){
                                        setblocklocation(false);
                                        audio_crash.play();  
                                        function setblocklocation(mybool){
                                            if(mybool==false){
                                                block.location_x = Math.floor(Math.random()*canvas.width)+1;
                                                block.location_y = Math.floor(Math.random()*canvas.height)+1;
                                                block.scale = Math.floor(Math.random()*50)+30;

                                                if(player.x > block.location_x-player.length && player.x< block.location_x+block.scale+player.length&&player.y<block.location_y+player.length&&player.y>block.loaction_y-block.scale-player.length){
                                                    mybool = false;    
                                                }else{
                                                    mybool = true;
                                                    

                                                    //안전한 위치일때 블록 생성
                                                    fblock.x.push(block.location_x);
                                                    fblock.y.push(block.location_y);
                                                    fblock.scale.push(block.scale);


                                                    wave.wavex = block.location_x-40;
                                                    wave.wavey = block.location_y+40;
                                                    wave.wavescale = block.scale+80;
                                                        
                                                    
                                                    
                                                    function waves(count){
                                                        if(count<canvas.width*canvas.height*3){
                                                            setTimeout(function(){
                                                                
                                                                wave.wavex -=40;
                                                                wave.wavey +=40;
                                                                wave.wavescale +=80;
                                                                count = wave.wavescale*wave.wavescale
                                                                
                                                                waves(count);
                                                            },50)
                                                        }
                                                    }
                                                    waves(block.scale*block.scale); //0.5초마다 파동 생성




                                                }
                                                setblocklocation(mybool);
                                            }
                                        }
                                        
                                        
                                        

                                        
                                        

                                        
                                    },gangdo_y*(Math.floor(Math.random()*4)+1)); 
                                    
                                }
                            },15000);
                            }else{
                                audio_bgm1.load();
                                audio_bgm1.play();
                                audio_crowd.load();
                                audio_crowd.play();
                                
                            }
                        },5000); //3000 인트로 기다리기
                        }





                </script>
                <p id="q"style=" margin-top: 5px;visibility:hidden; border-collapse: collapse; padding-bottom:1px;border-bottom: 2px solid white; float: right;"><span style="color:gray;"> moving with</span><strong>'WASD'</p>
            </div>
        </div>
    </div>
</div>
</body>
</html>
